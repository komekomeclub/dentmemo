<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÈöéÂ±§„É°„É¢</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f0ebe3;
    --surface: #e8e2d9;
    --border: #c8bfb0;
    --text: #3a342c;
    --text-muted: #8a7d6e;
    --accent: #b8650a;
    --bullet: #9a8b7a;
    --row-h: 48px;
    --font-size: 17px;
  }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* ===== „Éò„ÉÉ„ÉÄ„Éº ===== */
  header {
    padding: 14px 16px 12px;
    border-bottom: 1px solid var(--border);
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  header h1 {
    font-size: 16px;
    font-weight: 500;
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }

  /* ===== „É°„Éã„É•„Éº„Éú„Çø„É≥Ôºà„Éò„ÉÉ„ÉÄ„ÉºÂè≥Ôºâ ===== */
  #menu-btn {
    width: 36px; height: 36px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--bg);
    color: var(--text-muted);
    font-size: 18px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  #menu-btn:hover { background: var(--border); }
  #menu-btn:active { transform: scale(0.9); }

  /* ===== „Éâ„É≠„ÉØ„Éº„Ç™„Éº„Éê„Éº„É¨„Ç§ ===== */
  #drawer-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.25);
    z-index: 200;
  }
  #drawer-overlay.open { display: block; }

  /* ===== „Éâ„É≠„ÉØ„ÉºÊú¨‰Ωì ===== */
  #drawer {
    position: fixed;
    top: 0; right: -280px;
    width: 260px;
    height: 100%;
    background: var(--surface);
    border-left: 1px solid var(--border);
    z-index: 201;
    transition: right 0.25s ease;
    display: flex;
    flex-direction: column;
    padding: 0;
  }
  #drawer.open { right: 0; }

  .drawer-header {
    padding: 16px 16px 12px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .drawer-header h2 {
    font-size: 15px;
    font-weight: 500;
    color: var(--text-muted);
    letter-spacing: 0.04em;
  }
  #drawer-close {
    width: 30px; height: 30px;
    border: none;
    background: transparent;
    color: var(--text-muted);
    font-size: 20px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    border-radius: 6px;
    transition: background 0.12s;
  }
  #drawer-close:hover { background: var(--border); }

  .drawer-section {
    padding: 16px;
    border-bottom: 1px solid var(--border);
  }
  .drawer-section-title {
    font-size: 11px;
    font-weight: 500;
    color: var(--text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  /* „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ÈÅ∏Êäû */
  .font-size-options {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .font-size-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1.5px solid var(--border);
    background: var(--bg);
    cursor: pointer;
    transition: all 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .font-size-option:hover {
    border-color: var(--accent);
    background: rgba(184,101,10,0.05);
  }
  .font-size-option.active {
    border-color: var(--accent);
    background: rgba(184,101,10,0.1);
    color: var(--accent);
  }
  .font-size-option .size-label {
    font-size: 12px;
    color: var(--text-muted);
    flex: 1;
  }
  .font-size-option.active .size-label {
    color: var(--accent);
  }
  .font-size-option .size-preview {
    font-weight: 300;
  }
  .font-size-option .check-icon {
    width: 16px;
    font-size: 14px;
    text-align: center;
    color: var(--accent);
    opacity: 0;
  }
  .font-size-option.active .check-icon { opacity: 1; }

  /* ===== „É°„É¢„Ç≥„É≥„ÉÜ„Éä ===== */
  #memo-container {
    flex: 1;
    padding: 16px 12px 120px;
    overflow-y: auto;
  }

  .line-row {
    display: flex;
    align-items: flex-start;
    min-height: var(--row-h);
    border-radius: 6px;
    transition: background 0.1s;
    position: relative;
  }
  .line-row[data-indent="0"] { padding-left: 0; }
  .line-row[data-indent="1"] { padding-left: 28px; }
  .line-row[data-indent="2"] { padding-left: 56px; }

  .line-row.selected,
  .line-row:focus-within {
    background: rgba(184,101,10,0.07);
  }

  .line-row[data-indent="1"]::before {
    content: '';
    position: absolute;
    left: 14px; top: 0; bottom: 0;
    width: 2px;
    background: var(--border);
    opacity: 0.45;
    border-radius: 2px;
  }
  .line-row[data-indent="2"]::before {
    content: '';
    position: absolute;
    left: 42px; top: 0; bottom: 0;
    width: 2px;
    background: var(--border);
    opacity: 0.45;
    border-radius: 2px;
  }

  .line-icon {
    flex-shrink: 0;
    width: 28px;
    height: var(--row-h);
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    color: var(--bullet);
    user-select: none;
  }

  .toggle-btn {
    flex-shrink: 0;
    width: 28px;
    height: var(--row-h);
    display: flex; align-items: center; justify-content: center;
    font-size: 13px;
    color: var(--accent);
    background: transparent;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.12s;
    -webkit-tap-highlight-color: transparent;
  }
  .toggle-btn:hover { background: rgba(184,101,10,0.12); }
  .toggle-btn:active { transform: scale(0.88); }

  .line-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    font-family: inherit;
    font-size: var(--font-size);
    font-weight: 300;
    color: var(--text);
    line-height: 1.5;
    padding: 10px 8px 10px 2px;
    caret-color: var(--accent);
    resize: none;
    overflow: hidden;
    min-height: var(--row-h);
  }
  .line-input::placeholder { color: var(--border); }

  .line-wrap.hidden { display: none; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-3px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .line-row { animation: fadeIn 0.13s ease; }

  /* ===== „Éï„ÉÉ„Çø„Éº ===== */
  footer {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 100;
  }
  .footer-indent-group { display: flex; flex-direction: column; align-items: center; gap: 2px; }
  .footer-indent-btns  { display: flex; gap: 6px; }
  .indent-label        { font-size: 11px; color: var(--text-muted); letter-spacing: 0.03em; }

  .tool-btn {
    width: 48px; height: 48px;
    border-radius: 10px;
    border: 1.5px solid var(--border);
    background: var(--bg);
    color: var(--text);
    font-size: 20px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  .tool-btn:active { background: var(--accent); color: white; border-color: var(--accent); transform: scale(0.93); }
  .tool-btn:disabled { opacity: 0.3; cursor: default; }
  .tool-btn.primary { background: var(--accent); color: white; border-color: var(--accent); font-weight: bold; font-size: 22px; }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:var(--text-muted)">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
      <polyline points="14 2 14 8 20 8"/>
      <line x1="16" y1="13" x2="8" y2="13"/>
      <line x1="16" y1="17" x2="8" y2="17"/>
      <polyline points="10 9 9 9 8 9"/>
    </svg>
    <h1>ÈöéÂ±§„É°„É¢</h1>
  </div>
  <button id="menu-btn" title="„É°„Éã„É•„Éº">‚ò∞</button>
</header>

<!-- „Éâ„É≠„ÉØ„Éº„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
<div id="drawer-overlay"></div>

<!-- „Éâ„É≠„ÉØ„Éº -->
<div id="drawer">
  <div class="drawer-header">
    <h2>Ë®≠ÂÆö</h2>
    <button id="drawer-close">‚úï</button>
  </div>

  <div class="drawer-section">
    <div class="drawer-section-title">„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫</div>
    <div class="font-size-options" id="font-size-options">
      <button class="font-size-option" data-size="13">
        <span class="size-preview" style="font-size:13px">„ÅÇAa„ÅÇ</span>
        <span class="size-label">Â∞è (13px)</span>
        <span class="check-icon">‚úì</span>
      </button>
      <button class="font-size-option" data-size="15">
        <span class="size-preview" style="font-size:15px">„ÅÇAa„ÅÇ</span>
        <span class="size-label">‰∏≠ (15px)</span>
        <span class="check-icon">‚úì</span>
      </button>
      <button class="font-size-option active" data-size="17">
        <span class="size-preview" style="font-size:17px">„ÅÇAa„ÅÇ</span>
        <span class="size-label">Ê®ôÊ∫ñ (17px)</span>
        <span class="check-icon">‚úì</span>
      </button>
      <button class="font-size-option" data-size="20">
        <span class="size-preview" style="font-size:20px">„ÅÇAa„ÅÇ</span>
        <span class="size-label">Â§ß (20px)</span>
        <span class="check-icon">‚úì</span>
      </button>
      <button class="font-size-option" data-size="24">
        <span class="size-preview" style="font-size:24px">„ÅÇAa„ÅÇ</span>
        <span class="size-label">ÁâπÂ§ß (24px)</span>
        <span class="check-icon">‚úì</span>
      </button>
    </div>
  </div>
</div>

<div id="memo-container"></div>

<footer>
  <div class="footer-indent-group">
    <div class="footer-indent-btns">
      <button class="tool-btn" id="btn-outdent" title="„Éá„É≥„ÉàËß£Ê∂àÔºà‚ÜêÔºâ">‚Üê</button>
      <button class="tool-btn" id="btn-indent"  title="„Éá„É≥„ÉàÔºà‚ÜíÔºâ">‚Üí</button>
    </div>
    <span class="indent-label">„Ç§„É≥„Éá„É≥„Éà</span>
  </div>
  <button class="tool-btn primary" id="btn-add" title="Ë°å„ÇíËøΩÂä†">Ôºã</button>
  <button class="tool-btn" id="btn-delete" title="Ë°å„ÇíÂâäÈô§" style="font-size:18px;">üóë</button>
</footer>

<script>
// ================================================================
// „Éá„Éº„Çø
// ================================================================
let lines = [];
let selectedId = null;
let nextId = 1;
const STORAGE_KEY    = 'kaisou-memo-v3';
const FONT_SIZE_KEY  = 'kaisou-memo-fontsize';

// ================================================================
// „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ÁÆ°ÁêÜ
// ================================================================
const FONT_SIZES = [13, 15, 17, 20, 24];
let currentFontSize = 17;

function loadFontSize() {
  try {
    const saved = parseInt(localStorage.getItem(FONT_SIZE_KEY), 10);
    if (FONT_SIZES.includes(saved)) currentFontSize = saved;
  } catch(e) {}
}

function applyFontSize(size) {
  currentFontSize = size;
  document.documentElement.style.setProperty('--font-size', size + 'px');
  // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÈÅ∏Êäû„ÇíÊõ¥Êñ∞
  document.querySelectorAll('.font-size-option').forEach(el => {
    el.classList.toggle('active', parseInt(el.dataset.size, 10) === size);
  });
  // textarea „ÅÆÈ´ò„Åï„ÇíÂÜçË®àÁÆó
  autoResizeAll();
  try { localStorage.setItem(FONT_SIZE_KEY, size); } catch(e) {}
}

// ================================================================
// „Éâ„É≠„ÉØ„ÉºÈñãÈñâ
// ================================================================
function openDrawer() {
  document.getElementById('drawer').classList.add('open');
  document.getElementById('drawer-overlay').classList.add('open');
}
function closeDrawer() {
  document.getElementById('drawer').classList.remove('open');
  document.getElementById('drawer-overlay').classList.remove('open');
}

// ================================================================
// „Ç≥„Ç¢„É≠„Ç∏„ÉÉ„ÇØ
// ================================================================
function lineHasChildren(idx) {
  if (idx < 0 || idx >= lines.length - 1) return false;
  return lines[idx + 1].indent > lines[idx].indent;
}

function save() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ lines, nextId }));
  } catch(e) {}
}

function load() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      const data = JSON.parse(raw);
      if (data && Array.isArray(data.lines) && data.lines.length > 0) {
        lines = data.lines.map(l => ({
          id: l.id,
          text: l.text || '',
          indent: l.indent || 0,
          collapsed: l.collapsed || false
        }));
        nextId = data.nextId || (Math.max(...lines.map(l => l.id)) + 1);
        return;
      }
    }
  } catch(e) {}
  lines = [
    { id: nextId++, text: 'Âë≥ÂôåÊ±Å',   indent: 0, collapsed: false },
    { id: nextId++, text: '„ÉØ„Ç´„É°',   indent: 1, collapsed: false },
    { id: nextId++, text: 'Â§ßÊ†πÂÜ∑Âáç', indent: 1, collapsed: false },
    { id: nextId++, text: 'Ê≤πÊèö„Åí',   indent: 1, collapsed: false },
    { id: nextId++, text: 'ÈÆ≠',       indent: 0, collapsed: false },
    { id: nextId++, text: '„Åî„ÅØ„Çì',   indent: 0, collapsed: false },
  ];
}

function calcHiddenIds() {
  const hidden = new Set();
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].collapsed && lineHasChildren(i)) {
      for (let j = i + 1; j < lines.length; j++) {
        if (lines[j].indent > lines[i].indent) hidden.add(lines[j].id);
        else break;
      }
    }
  }
  return hidden;
}

function render() {
  const container = document.getElementById('memo-container');
  container.innerHTML = '';
  const hidden = calcHiddenIds();

  for (let idx = 0; idx < lines.length; idx++) {
    const line = lines[idx];
    const hasKids = lineHasChildren(idx);

    const wrap = document.createElement('div');
    wrap.className = 'line-wrap';
    if (hidden.has(line.id)) wrap.classList.add('hidden');

    const row = document.createElement('div');
    row.className = 'line-row';
    row.dataset.id = String(line.id);
    row.dataset.indent = String(line.indent);
    if (line.id === selectedId) row.classList.add('selected');

    // Â∑¶„Ç¢„Ç§„Ç≥„É≥
    if (hasKids) {
      const btn = document.createElement('button');
      btn.className = 'toggle-btn';
      btn.textContent = line.collapsed ? '‚ñ∑' : '‚ñΩ';
      btn.title = 'Â±ïÈñã/Êäò„Çä„Åü„Åü„Åø';
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const li = lines.find(l => l.id === line.id);
        if (li) { li.collapsed = !li.collapsed; save(); render(); focusLine(li.id); }
      });
      row.appendChild(btn);
    } else {
      const icon = document.createElement('div');
      icon.className = 'line-icon';
      icon.textContent = '‚Ä¢';
      row.appendChild(icon);
    }

    // „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢
    const ta = document.createElement('textarea');
    ta.className = 'line-input';
    ta.value = line.text;
    ta.rows = 1;
    if (idx === 0) ta.placeholder = '„É°„É¢„ÇíÂÖ•Âäõ...';

    ta.addEventListener('input', () => {
      ta.style.height = 'auto';
      ta.style.height = ta.scrollHeight + 'px';
      line.text = ta.value;
      save();
    });
    ta.addEventListener('focus', () => {
      selectedId = line.id;
      document.querySelectorAll('.line-row.selected').forEach(el => el.classList.remove('selected'));
      row.classList.add('selected');
      updateButtonStates();
    });
    ta.addEventListener('keydown', (e) => handleKeyDown(e, line));

    row.appendChild(ta);
    wrap.appendChild(row);
    container.appendChild(wrap);
  }

  updateButtonStates();
  requestAnimationFrame(autoResizeAll);
}

function autoResizeAll() {
  document.querySelectorAll('.line-input').forEach(ta => {
    ta.style.height = 'auto';
    ta.style.height = ta.scrollHeight + 'px';
  });
}

function focusLine(id) {
  selectedId = id;
  requestAnimationFrame(() => {
    const ta = document.querySelector(`.line-row[data-id="${id}"] .line-input`);
    if (ta) {
      ta.focus();
      ta.setSelectionRange(ta.value.length, ta.value.length);
      ta.style.height = 'auto';
      ta.style.height = ta.scrollHeight + 'px';
    }
    updateButtonStates();
  });
}

function handleKeyDown(e, line) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    const idx = lines.findIndex(l => l.id === line.id);
    const newLine = { id: nextId++, text: '', indent: line.indent, collapsed: false };
    lines.splice(idx + 1, 0, newLine);
    save(); render(); focusLine(newLine.id);
  } else if (e.key === 'Backspace' && line.text === '') {
    e.preventDefault();
    if (line.indent > 0) {
      line.indent--;
      save(); render(); focusLine(line.id);
    } else {
      const idx = lines.findIndex(l => l.id === line.id);
      if (lines.length > 1) {
        lines.splice(idx, 1);
        save(); render();
        focusLine(lines[Math.max(0, idx - 1)].id);
      }
    }
  }
}

function getSelectedLine() {
  if (selectedId == null) return null;
  return lines.find(l => l.id === selectedId) || null;
}

function indentSelected() {
  const line = getSelectedLine();
  if (!line || line.indent >= 2) return;
  line.indent++;
  save(); render(); focusLine(line.id);
}

function outdentSelected() {
  const line = getSelectedLine();
  if (!line || line.indent <= 0) return;
  line.indent--;
  save(); render(); focusLine(line.id);
}

function addLineAfterSelected() {
  const line = getSelectedLine();
  const idx = line ? lines.findIndex(l => l.id === line.id) : lines.length - 1;
  const indent = line ? line.indent : 0;
  const newLine = { id: nextId++, text: '', indent, collapsed: false };
  lines.splice(idx + 1, 0, newLine);
  save(); render(); focusLine(newLine.id);
}

function deleteSelected() {
  const line = getSelectedLine();
  if (!line) return;
  if (lines.length <= 1) {
    lines[0].text = '';
    save(); render(); focusLine(lines[0].id);
    return;
  }
  const idx = lines.findIndex(l => l.id === line.id);
  lines.splice(idx, 1);
  save(); render();
  focusLine(lines[Math.max(0, idx - 1)].id);
}

function updateButtonStates() {
  const line = getSelectedLine();
  document.getElementById('btn-indent').disabled  = !line || line.indent >= 2;
  document.getElementById('btn-outdent').disabled = !line || line.indent <= 0;
}

// ================================================================
// „Çª„É´„Éï„ÉÅ„Çß„ÉÉ„ÇØ
// ================================================================
function selfCheck() {
  const errors = [];

  // 1. „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ CSSÂ§âÊï∞„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„Åã
  const cssFontSize = getComputedStyle(document.documentElement).getPropertyValue('--font-size').trim();
  if (cssFontSize !== currentFontSize + 'px') {
    errors.push('„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫CSSÂ§âÊï∞„Åå‰∏ç‰∏ÄËá¥: expected=' + currentFontSize + 'px, actual=' + cssFontSize);
  }

  // 2. active„ÇØ„É©„Çπ„ÅåÊ≠£„Åó„ÅÑÈÅ∏ÊäûËÇ¢„Å´‰ªò„ÅÑ„Å¶„ÅÑ„Çã„Åã
  const activeOptions = document.querySelectorAll('.font-size-option.active');
  if (activeOptions.length !== 1) {
    errors.push('active„Å™„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ÈÅ∏ÊäûËÇ¢„ÅÆÊï∞„Åå‰∏çÊ≠£: ' + activeOptions.length);
  } else {
    const activeSize = parseInt(activeOptions[0].dataset.size, 10);
    if (activeSize !== currentFontSize) {
      errors.push('active„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫„Åå‰∏ç‰∏ÄËá¥: expected=' + currentFontSize + ', actual=' + activeSize);
    }
  }

  // 3. hasChildren / „Éà„Ç∞„É´„Éú„Çø„É≥Âà§ÂÆö
  const idx0 = lines.findIndex(l => l.text === 'Âë≥ÂôåÊ±Å');
  if (idx0 >= 0) {
    if (!lineHasChildren(idx0)) {
      errors.push('Âë≥ÂôåÊ±Å: hasChildren=false (true„ÅÆ„ÅØ„Åö)');
    } else {
      const row = document.querySelector('.line-row[data-id="' + lines[idx0].id + '"]');
      if (row && !row.querySelector('.toggle-btn')) {
        errors.push('Âë≥ÂôåÊ±ÅË°å: toggle-btn„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ');
      }
    }
  }

  // 4. „Éâ„É≠„ÉØ„Éº„ÅÆÈñãÈñâ„Åå DOM ‰∏ä„ÅßÊ≠£„Åó„ÅèÊ©üËÉΩ„Åô„Çã„Åã
  openDrawer();
  const drawerOpen = document.getElementById('drawer').classList.contains('open');
  closeDrawer();
  const drawerClosed = !document.getElementById('drawer').classList.contains('open');
  if (!drawerOpen)   errors.push('openDrawer() „ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ');
  if (!drawerClosed) errors.push('closeDrawer() „ÅåÊ©üËÉΩ„Åó„Å¶„ÅÑ„Å™„ÅÑ');

  // 5. „Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫Âàá„ÇäÊõø„Åà„ÉÜ„Çπ„Éà (15px „Å´Â§â„Åà„Å¶Êàª„Åô)
  const originalSize = currentFontSize;
  applyFontSize(15);
  const changed = getComputedStyle(document.documentElement).getPropertyValue('--font-size').trim();
  applyFontSize(originalSize);
  if (changed !== '15px') {
    errors.push('applyFontSize(15) „Åå --font-size „Å´ÂèçÊò†„Åï„Çå„Å™„Åã„Å£„Åü: ' + changed);
  }

  if (errors.length === 0) {
    console.log('[selfCheck] ‚úì ÂÖ®„ÉÅ„Çß„ÉÉ„ÇØÈÄöÈÅé');
  } else {
    errors.forEach(e => console.error('[selfCheck] ‚úó ' + e));
  }
  return errors.length === 0;
}

// ================================================================
// „Ç§„Éô„É≥„ÉàÁôªÈå≤ & ÂàùÊúüÂåñ
// ================================================================
document.getElementById('menu-btn').addEventListener('click', openDrawer);
document.getElementById('drawer-close').addEventListener('click', closeDrawer);
document.getElementById('drawer-overlay').addEventListener('click', closeDrawer);

document.getElementById('font-size-options').addEventListener('click', (e) => {
  const opt = e.target.closest('.font-size-option');
  if (!opt) return;
  const size = parseInt(opt.dataset.size, 10);
  if (!isNaN(size)) applyFontSize(size);
});

document.getElementById('memo-container').addEventListener('click', e => {
  if (e.target === e.currentTarget && lines.length > 0)
    focusLine(lines[lines.length - 1].id);
});
document.getElementById('btn-indent').addEventListener('click', indentSelected);
document.getElementById('btn-outdent').addEventListener('click', outdentSelected);
document.getElementById('btn-add').addEventListener('click', addLineAfterSelected);
document.getElementById('btn-delete').addEventListener('click', deleteSelected);

loadFontSize();
load();
render();
applyFontSize(currentFontSize);

requestAnimationFrame(() => {
  if (lines.length > 0) focusLine(lines[0].id);
  selfCheck();
});
</script>
</body>
</html>
